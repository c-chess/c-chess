# c-chess

c-chess是一个中国象棋后端程序。

## API

房间相关的使用HTTP协议，游戏过程的接口使用WebSocket协议。

### HTTP描述

如果不做说明则请求方法为POST，响应JSON，响应的数据中一定包含`status`表示状态码和`message`字段，如果有其他数据则放在`data`字段。

#### 响应示例

```json
{
  	"status": 0,
  	"message": "ok"
}
```

#### 状态码

| 状态码 |    含义    |
| :----: | :--------: |
|   0    |    正常    |
|  -100  | 房间不存在 |

#### 接口

##### 加入房间 - `/room/join`

###### 请求参数

| 参数名 |  类型  | 备注 |
| :----: | :----: | :--: |
| 房间号 | Number |  -   |

###### 响应

|  参数名   |  类型  |      备注      |
| :-------: | :----: | :------------: |
| 红子/黑子 | Number | 1.红子，2.黑子 |

##### 新建房间 - `/room/new`

###### 响应

|  参数名   |  类型  |      备注      |
| :-------: | :----: | :------------: |
|  房间号   | Number |       -        |
| 红子/黑子 | Number | 1.红子，2.黑子 |

### WebSocket描述

#### 数据帧格式

|   描述   | 数据类型 | 长度（单位：字节） |    备注    |
| :------: | :------: | :----------------: | :--------: |
|   帧头   |    -     |         1          | 固定为0x99 |
| 类别标识 |  uint8   |         1          | 见下方表格 |
|   数据   |    -     |     由类别决定     |     -      |
|  校验和  |  uint8   |         1          |     -      |

#### 数据帧类别

|   名称   | 类别标识 | 数据长度（单位：字节） |                           数据描述                           |
| :------: | :------: | :--------------------: | :----------------------------------------------------------: |
| 开始游戏 |   0x11   |           0            |                              -                               |
| 黑子走棋 |   0x22   |           4            | 4个uint8数据，分别表示源位置横坐标和纵坐标、目标位置横坐标和纵坐标。以红子视角的左下方为原点，向右和向上为正方向。 |
| 红子走棋 |   0x33   |           4            |                             同上                             |
| 走棋错误 |   0x82   |           0            |                              -                               |

